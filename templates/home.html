<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Grace Rodriguez's Website</title>
  <meta name="description" content="Web Portafolio">
  <meta name="author" content="SitePoint">

  <link rel="stylesheet" href="../static/css/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
</head>

<script>
  //variable App either returns the attributes if it's ready or an empty object
  var App = window.App || {};
  // var link = "#home";

  //For a cleaner code, all of the functions and variables for the canvas can be added
  //to one object
  App.myCanvas =  function(){
        //Ship and canvas     
    var moveLeft = 0,
        moveRight = 0,
        keyStatus = {},
        canvas,
        ctx;

       links = "#home";
    
    //Values to set opacity for fading
    var opacity = 1, 
        factor = 1,
        increment = .01;
    var numStars = 60;

      /*Timing and main loop */
      var currentState = history.state
      // console.log("Curr: ",currentState)
      prevLinkBool = false;

      //Time variables
      var startTime = 0;
      var lastTime = 0;
      var elapsed = 0, totalElapsed = 0;
      var newLink = [];

      //Url manipulation variables
      var selector, elems, makeActive;

      //Select nav items as list
      selector = '.nav li';
      //Save it in an array
      elems = document.querySelectorAll(selector);
      getElemHashes = document.querySelectorAll('.nav a')

      //For easier management, save the hashes only
      elemHashes = []
      for (var i = 0; i < getElemHashes.length; i++){
        elemHashes.push(getElemHashes[i].hash)
      }

      window.requestAnimFrame = (function() {
      return window.requestAnimationFrame ||
             window.webkitRequestAnimationFrame ||
             window.mozRequestAnimationFrame ||
             window.oRequestAnimationFrame ||
             window.msRequestAnimationFrame ||
             function(/* function FrameRequestCallback */ callback, /* DOMElement Element */ element) {
               window.setTimeout(callback, 1000/60);
             };
    })();
    init = function(){
      this.initParams();
      start();

    },
    
    start = function() {
      // stuff from below
      console.log("starting...");

      canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');

      xVal = Array.from({length: numStars}, () => Math.floor(Math.random() * canvas.width));
      yVal = Array.from({length: numStars}, () => Math.floor(Math.random() * canvas.height));
      op = Array.from({length: numStars}, () => Math.random());

      initParams();
      initKeys(canvas);

      drawAll();

      onTick();

    },

    initParams = function(){
      params = {
        'x0': 0,
        'y0': 0,
        'fixedDisplacement': 20, // 20 pix/s
        'angleStep': 15, // 15 deg for each keyPress
        // For Mode 1
        'fixedVelocity': 400, // 20 pix/s
        'fixedAcceleration': 0.1 // 0.1 pix/s velocity if accelerate for 1s
      }
      flameEndX = params.x0;
    }
    initKeys = function(canvas){
        // Make sure the canvas can receive the key events
        canvas.setAttribute('tabindex','0');
        canvas.focus();

        // Register the keyDown and keyUp events
        canvas.addEventListener( "keydown", onKeyDown, true);
        canvas.addEventListener( "keyup", onKeyUp, true);
         
        for (var i = 0; i < elems.length; i++)
            elems[i].addEventListener('mousedown', makeActive);

    },
    isKeyDown = function(keyCode){
        return keyStatus[keyCode]
    },
    //Callbacks for discrete key events
    onKeyDown= function(event){
    
      console.log(event);
      
      event.preventDefault();
      keyStatus[event.keyCode] = true;
    }, 
    onKeyUp = function(event){
      //When the keys stop being pressed, delete the elements in keyStatus
      delete keyStatus[event.keyCode]
    },
    
    //Activate new nav item 
    //Example taken from http://jsfiddle.net/rn3nc/1/
    makeActive = function () {
      links = $(event.target).attr('href');
      //console.log("Push link: ",links)
      window.history.pushState('','',links)

    for (var i = 0; i < elems.length; i++)
        elems[i].classList.remove('active');

      this.classList.add('active');
    },
    
    makeActiveWithShip = function(next,whichNavItem){

      //next is the index of the next nav item
      links = elemHashes[next]
      //push new hash to url
      window.history.pushState('','',links)

      //Check which direction ship is going to subtract or add for the change
      //of nav item
      if(whichNavItem == "next")
        elems[next-1].classList.remove('active');
      else
        elems[next+1].classList.remove('active');

      elems[next].classList.add('active');

    },

    updateTime = function(){
      var timeNow = new Date().getTime() / 1000; // All expressed in seconds
      if (lastTime != 0) {
        elapsed = timeNow - lastTime;
      } else {
        startTime = timeNow;
      }
      lastTime = timeNow;
      totalElapsed = timeNow - startTime;
    },

    boxEffect = function(){
 
      box1 = document.getElementById("textBox1")
      box2 = document.getElementById("textBox2")
      box3 = document.getElementById("textBox3")

      if (links == "#home" || links == undefined){   
        box1.style.display = "block";
        box2.style.display = "none";
        box3.style.display = "none";
      }else if( links == "#education"){
        box1.style.display = "none";
        box2.style.display = "block";
        box3.style.display = "none";
      }else if(links == "#skills"){
        box1.style.display = "none";
        box2.style.display = "none";
        box3.style.display = "block";
      }
      else{
        box3.style.display = "none";
        box2.style.display = "none";
        box1.style.display = "none";
      }
      
    },

    // Timer callback for animations
    onTick = function(){
          updateTime()
          animate();
          drawAll();
        
        requestAnimFrame(onTick);
    },
    animate = function(){
        params.vx = 0;
        params.vy = 0;
        whichNavItem = "";
        // console.log("here")
        // console.log("links: ", links)

        //React to arrow right
        if(isKeyDown(39)){
          console.log("x0: ",params.x0,"y0: ",params.y0)

          if (links =="#experience" && params.x0 > canvas.width-150){
             params.x0 +=0
          }
          else{
            params.x0 += (params.fixedVelocity*elapsed)
          }

        }
        //React to arrow left
        else if(isKeyDown(37)){
          console.log("x0: ",params.x0,"y0: ",params.y0)
          //At least we can access links through here
          if ((links== "#home" || links == undefined) && params.x0 < 1){
             params.x0 -=0
          }
          else{
            params.x0 -= (params.fixedVelocity*elapsed)
          }
        }

        //When ship goes to the end of the canvas
        if(params.x0 > canvas.width){
          params.x0 = 0;
          whichNavItem = "next";
          
          curr = elemHashes.indexOf(links)    
          next = curr + 1
          
          if (next < elemHashes.length)
              makeActiveWithShip(next,whichNavItem);

        //when the ship goes to the beginning of the canvas
        }else if (params.x0 < -170){
          params.x0 = canvas.width - 150;
          whichNavItem = "prev";
          curr = elemHashes.indexOf(links)
          //console.log("Current h: ",curr)      
          next = curr - 1
          
          if (next >= 0)
              makeActiveWithShip(next,whichNavItem);
        }
        //Space bar pressing - use for testing                
        // if(isKeyDown(32)){
           
        // }
        boxEffect();
    },

    drawShip = function(ctx){
      // ship = document.getElementById('ship');

      // ctx.translate(params.x0,params.y0);

      ctx.drawImage(ship,2,350, 170,100);

    },

    drawlightFire = function(ctx){
      // ctx.translate(params.x0,params.y0);
      ctx.drawImage(lightFire,0,350, 25,18);
    },

    drawDarkFire = function(ctx){
      // ctx.translate(params.x0,params.y0);
      flameX = elapsed * Math.random();
      ctx.drawImage(darkFire,flameX,350, 35,25);
    },

    drawStars = function(ctx){

      
        // ctx.beginPath();
        // //Top
        // ctx.moveTo(100, 50);
        // ctx.lineTo(83, 85);
        // //Top Left end
        // ctx.lineTo(48,100);
        // ctx.lineTo(80,115);
        // //Bottom left end
        // ctx.lineTo(68,155);
        // //Bottom
        // ctx.lineTo(100,135);
        // //Bottom right end
        // ctx.lineTo(130,155);
        // ctx.lineTo(125,115);
    
        // //Top right End
        // ctx.lineTo(153,100);
        // ctx.lineTo(118, 85);
        // ctx.closePath();
        

     },

     createStars = function(ctx,x,y,opacity){

        ctx.translate(x, y);
        ctx.beginPath()
        ctx.rotate(45*Math.PI/180)
        ctx.fillStyle = 'rgba(255, 255, 200, ' + opacity + ')';
        ctx.shadowBlur = 5;
        ctx.shadowColor = '#ffff33';
        ctx.fillRect(0,0,5,5);
        ctx.closePath();


     },

    
    fade = function(ctx){

     
      
      if(opacity >= 1) {
        factor = -1
        // clearInterval(interval)
      }
      else if(opacity <= 0) {
        factor = 1 ;
      }
      opacity += factor *increment;
      // console.log("opacity",opacity);

      for (var j = 0; j < numStars;j++){
          ctx.save();
          createStars(ctx,xVal[j],yVal[j],opacity);
          ctx.restore();
      }

      // ctx.save();
      // createStars(ctx,400,300,opacity);
      // ctx.restore();
      // ctx.save();
      // drawStars(ctx);
        // }, 1000/steps);
    },

    drawAll = function(){
      //Reset before clearing the canvas
      ctx.setTransform(1,0,0,1,0,0);
      ctx.clearRect(0,0,canvas.width,canvas.height);
      // space = document.getElementById('background');
      space = document.getElementById('background');
      ship = document.getElementById('ship');
      lightFire = document.getElementById('lightFire');
      darkFire = document.getElementById('darkFire');
      

      //Draw background      
      var pattern = ctx.createPattern(space,'repeat-x');
      ctx.rect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = pattern;
      ctx.fill();

      //Fade in effect
      ctx.save();
      fade(ctx);
      ctx.restore();

      if (isKeyDown(39) || isKeyDown(37)){
        
        ctx.save()
        ctx.translate(params.x0+7, params.y0+34)
        drawDarkFire(ctx);
        ctx.restore();

        ctx.save()
        ctx.translate(params.x0+16, params.y0+37)
        drawlightFire(ctx);
        ctx.restore();
      }

      ctx.save();
      ctx.translate(params.x0, params.y0);
      drawShip(ctx);
      ctx.restore();
 
      // drawlightFire(ctx);
 

    }

    //Init the canvas
    init();
  };

//all of the json script goes here

  $(function(){
    App.myCanvas();

    // var $navigationItem = $('.nav a'),
    //     $navigationItemActive = $('li.activate');
    //     links = '#home';

    // //activate function when navbar items are pressed
    // $navigationItem.on('click',function (event) {
    //     var $item = $(this)

    //     event.preventDefault();
    //     links = $(event.target).attr('href');
    //     window.history.pushState('','',links)
        //highlightItem($item);
        // console.log(ev.target)
        
        //push the href to the end of the link
        //console.log("Link 0: ", links)
      
    // });

    // function highlightItem($item){        
    //     window.history.pushState('','',links)
    //     //removing the previous selected menu state
    //     $('.nav').find('li.active').removeClass('active');
    //     //adding the state for this parent menu
    //     $item.parents("li").addClass('active');
    // }

  });

    
  </script>

<body ">

<div class="navigation">
<ul class="nav">
  <li id="home" class="active">
    <a href="#home">Home</a>
  </li>
  <li>
    <a href="#education">Education</a>
  </li>
  <li>
    <a href="#skills">Skills</a>
  </li>
  <li>
    <a href="#experience">Experience</a>
  </li>
</ul>
<div>

<div class="bodyContent" onload="start();">
  <div style="display:none;">
    <img id="background" src="../static/img/space_background.png" > 

    <!-- Spaceship recovered from https://www.vecteezy.com/ -->
    <img id="ship"  src="../static/img/spaceship1.svg"> 
    <img id="lightFire" src="../static/img/lightFire.svg">
    <img id="darkFire" src="../static/img/darkFire.svg">
    <img id="blueStar" src="../static/img/blueStar.svg">
    <img id="whiteStar" src="../static/img/whiteStar.svg">
  </div>
  <tb>
    <!-- Gotta edit canvas dimensions -->
    <canvas id="canvas" width="1240" height="480" class:"bodyCanvas" ></canvas>
  </tb>
  <div onclick="boxEffect()" id="textBox1" class="inTextBox" style=stat>
    <p>Move the ship left by pressing &#8592; and move right by pressing &#8594;</p>
    <p>Make sure the image is pressed.</p>
  </div> 

  <div onclick="boxEffect()" id="textBox2" class="inTextBox" style=stat>
    <p>Bachelor of Science in Computer Science</p>
    <p>University of Puerto Rico - Rio Piedras Campus</p>
  </div> 

  <div onclick="boxEffect()" id="textBox3" class="inTextBox" style=stat>
    <p class="title">---------------------------- Code ----------------------------</p>
    <p>Html5 - Css - Python - Javascript</p>
    <p class="title">---------------------------- Design ----------------------------</p>
    <p>Photoshop - Gimp - HTML5 Canvas </p>
    <p class="title">--------------------------- Others ---------------------------</p>
    <p>Fluent in Spanish and English - Unity3d - Git - Unix </p> 

  </div> 

<!-- 
  <svg width="100%" height="550"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink">

    <defs>
      <pattern patternUnits="userSpaceOnUse" id="space" x="0" y="0" width="888" height="483">
        <image xlink:href="../static/img/space_background.png" x="0" y="0" width="888" height="483" />
      </pattern>
    </defs>

      <rect x="0" y="0" width="100%" height="88%" stroke="black" stroke-width="2" fill="url(#space)" />
    <image id="spaceship" xlink:href="../static/img/spaceship.svg" x="10" y="10" width="199" height="178" />

  </svg> -->

</div>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
  <script src="https://npmcdn.com/tether@1.2.4/dist/js/tether.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
</body>
</html>